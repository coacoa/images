<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>NixOS + Samba NAS ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ãƒ¡ãƒ¢</title>
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; line-height: 1.6; margin: 40px; }
    h1, h2, h3 { color: #2c3e50; }
    pre { background: #f6f8fa; padding: 12px; overflow-x: auto; }
    code { color: #c7254e; }
    .ok { color: green; }
    .ng { color: red; }
    .note { background: #eef6ff; padding: 10px; border-left: 4px solid #4da3ff; }
  </style>
</head>
<body>

<h1>NixOS + Samba NAS ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ãƒ¡ãƒ¢</h1>
<p>ç›®çš„ï¼š<strong>NixOS ä¸Šã§ 32GB (mmc) ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ NAS ã¨ã—ã¦å…±æœ‰ã™ã‚‹</strong></p>

<hr />

<h2>1. ãƒ‡ã‚£ã‚¹ã‚¯æ§‹æˆã®ç¢ºèª</h2>
<pre><code>lsblk</code></pre>
<p>ä¾‹ï¼š</p>
<pre><code>sda        128G  â†’ NixOS æœ¬ä½“
mmcblk0     32G  â†’ NAS ç”¨ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯</code></pre>

<hr />

<h2>2. NAS ç”¨ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</h2>
<p class="note">â€» ãƒ‡ãƒ¼ã‚¿ã¯æ¶ˆãˆã‚‹ã®ã§æ³¨æ„</p>
<pre><code>sudo mkfs.ext4 /dev/mmcblk0p1
sudo e2label /dev/mmcblk0p1 NAS32G</code></pre>

UUID ç¢ºèªï¼š
<pre><code>lsblk -f /dev/mmcblk0p1</code></pre>

<hr />

<h2>3. ãƒã‚¦ãƒ³ãƒˆè¨­å®š</h2>
<pre><code>sudo mkdir -p /mnt/nas</code></pre>

<pre><code># /etc/nixos/configuration.nix
fileSystems."/mnt/nas" = {
  device = "/dev/disk/by-uuid/XXXX-XXXX";
  fsType = "ext4";
  options = [ "noatime" "nodiratime" ];
};</code></pre>

<pre><code>sudo nixos-rebuild switch</code></pre>

<hr />

<h2>4. Samba ã‚’æœ‰åŠ¹åŒ–</h2>
<pre><code># /etc/nixos/configuration.nix
services.samba = {
  enable = true;
  shares.nas = {
    path = "/mnt/nas";
    browseable = "yes";
    writable = "yes";
    guestOk = "no";
  };
};</code></pre>

<hr />

<h2>5. ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šï¼ˆé‡è¦ï¼‰</h2>
<p class="ng">ã“ã‚Œã‚’å¿˜ã‚Œã‚‹ã¨å¤–éƒ¨ã‹ã‚‰æ¥ç¶šã§ããªã„</p>
<pre><code># /etc/nixos/configuration.nix
networking.firewall = {
  enable = true;
  allowedTCPPorts = [ 445 139 ];
  allowedUDPPorts = [ 137 138 ];
};</code></pre>

<pre><code>sudo nixos-rebuild switch</code></pre>

<hr />

<h2>6. Samba ã‚µãƒ¼ãƒ“ã‚¹ç¢ºèª</h2>
<pre><code>systemctl status samba-smbd</code></pre>
<p class="ok">active (running) ãªã‚‰ OK</p>

<hr />

<h2>7. Samba ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼ˆè¶…é‡è¦ï¼‰</h2>
<p>Linux ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ Samba ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯åˆ¥</p>
<pre><code>sudo smbpasswd -a hoge
sudo smbpasswd -e hoge</code></pre>

ç¢ºèªï¼š
<pre><code>pdbedit -L</code></pre>

<hr />

<h2>8. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ¨©é™è¨­å®š</h2>
<pre><code>sudo chown -R hoge:users /mnt/nas
sudo chmod -R 775 /mnt/nas</code></pre>

<hr />

<h2>9. æ¥ç¶šãƒ†ã‚¹ãƒˆ</h2>
<h3>Linux</h3>
<pre><code>smb://192.168.1.111/nas</code></pre>

<h3>Windows</h3>
<pre><code>\\192.168.1.111\nas</code></pre>

<p>ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼š<code>hoge</code><br />
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼š<strong>smbpasswd ã§è¨­å®šã—ãŸã‚‚ã®</strong></p>

<hr />

<h2>10. å®Œæˆ ğŸ‰</h2>
<ul>
  <li>NixOS æœ¬ä½“ï¼š128GB SSD</li>
  <li>NAS ãƒ‡ãƒ¼ã‚¿ï¼š32GB mmc</li>
  <li>Samba èªè¨¼ï¼šæœ‰åŠ¹</li>
</ul>

<p class="note">ã“ã® HTML ã¯ã€Œè¨­å®šãƒ¡ãƒ¢ + HTML å­¦ç¿’ç”¨ã€ã¨ã—ã¦ãã®ã¾ã¾ä¿å­˜ãƒ»ç·¨é›†å¯èƒ½</p>

</body>
</html>

